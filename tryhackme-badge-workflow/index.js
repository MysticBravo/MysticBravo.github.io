const{spawn:spawn}=require("child_process"),fetch=require("node-fetch"),core=require("@actions/core"),github=require("@actions/github"),fs=require("fs"),GITHUB_TOKEN=core.getInput("GITHUB_TOKEN"),FILEPATH=core.getInput("image_path"),THM_USERNAME=core.getInput("username"),exec=(e,t=[],o={})=>new Promise((i,c)=>{let a="";const r={...o};r.stdio||Object.assign(r,{stdio:["inherit","inherit","inherit"]});const n=spawn(e,t,r);n.stdout&&n.stdout.on("data",function(e){a+=e.toString()}),n.on("close",e=>0!==e?c({code:e,outputData:a}):i({code:e,outputData:a})),n.on("error",()=>c({code:1,outputData:a}))});core.setSecret(GITHUB_TOKEN);const dlImg=async(e,t,o)=>{const i=`https://tryhackme-badges.s3.amazonaws.com/${o}.png`,c=t,a=core.getInput("committer_username"),r=core.getInput("committer_email"),n=core.getInput("commit_message"),s=await fetch(i),g=fs.createWriteStream(c);await new Promise((e,t)=>{s.body.pipe(g),s.body.on("error",t),g.on("finish",e)}),await exec("git",["config","--global","user.email",r]),await exec("git",["config","--global","user.name",a]),e&&await exec("git",["remote","set-url","origin",`https://${e}@github.com/${process.env.GITHUB_REPOSITORY}.git`]),await exec("git",["commit","-m",n]),await exec("git",["add",t]),await exec("git",["push"])};dlImg(GITHUB_TOKEN,FILEPATH,THM_USERNAME)["catch"](()=>{console.log("nothing to commit")});